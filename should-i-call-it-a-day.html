<!doctype html>
<html>
    <head>
        <title>360Â°</title>
        <script src="https://cdn.rawgit.com/remy/bind/928c52ce335d6fd2c824b536a97efa460554b9e0/dist/bind.min.js"></script>
        <script src="https://momentjs.com/downloads/moment.min.js"></script>
    </head>
    <body style="text-align:center">
        <center>
            <p><img src="https://i.redd.it/emdqzy260ar41.jpg"></p>
            <p>
                <table style="text-align:right">
                    <tr>
                        <td>you started at</td>
                        <td><input id="start" size="2" style="text-align:center;"></td>
                    </tr>
                    <tr>
                        <td>your work day (in hours) is</td>
                        <td><input id="workday" size="2" style="text-align:center;"></td>
                    </tr>
                    <tr>
                        <td>your included break (in minutes) is</td>
                        <td><input id="break" size="2" style="text-align:center;"></td>
                    </tr>
                    <tr>
                        <td style="padding-top:15px">
                            you better call it a day around
                        </td>
                        <td style="padding-top:15px">
                            <input id="end" size="2" style="text-align:center;" readonly>
                        </td>
                    </tr>
                </table>
            </p>
            <br>
            <p>bookmark this page to save your settings.</p>
        </center>

        <script>
            Bind({
              start: getTime(),
              workday: getQueryParam('workday') || 7.7,
              _break: getQueryParam('break') || 45
            }, {
              start: {
                dom: '#start',
                callback: function() {
                  var start = getInput('#start');
                  setEndTime({ start });
                }
              },
              workday: {
                dom: '#workday',
                callback: function() {
                  var workday = getInput('#workday');
                  setEndTime({ workday });
                  setQueryParam('workday', workday);
                }
              },
              _break: {
                dom: '#break',
                callback: function() {
                  var _break = getInput('#break');
                  setEndTime({ _break });
                  setQueryParam('break', _break);
                }
              }
            });

            document.querySelector('#start').select();

            function setEndTime({ start, workday, _break } = {}) {
                var end = moment(start || getInput('#start'),'HH:mm')
                    .add(workday || getInput('#workday'), 'hour')
                    .add(_break || getInput('#break'), 'minute')
                    .format('HH:mm');
                document.querySelector('#end').value = end;
            }

            function getTime() {
                return moment().format('HH:mm');
            }

            function getInput(id) {
                return document.querySelector(id).value;
            }

            function getQueryParam(k) {
                var match = new RegExp('[&?]' + k + '=([^&]+)').exec(location.search);
                return match ? match[1] : undefined;
            }

            function setQueryParam(k, v) {
                if (queryHasParamAndValue(k, v)) return;
                var query = queryHasParam(k)
                    ? replaceQueryParam(k, v)
                    : appendQueryParam(k, v);
                setUrl(query);
            }

            function replaceQueryParam(k, v) {
                return location.search.replace(
                    new RegExp('([&?])' + k + '=[^&]+'),
                    '$1' + k + '=' + v);
            }

            function appendQueryParam(k, v) {
                return queryHasNoParams()
                    ? '?' + k + '=' + v
                    : location.search + '&' + k + '=' + v;
            }

            function setUrl(query) {
                var url = location.toString().replace(location.search, '');
                window.history.pushState('foo', 'Title', url + query);
            }

            function queryHasParamAndValue(k, v) {
                return new RegExp('[&?]' + k + '=' + v + '(&|$)').test(location.search);
            }

            function queryHasParam(k) {
                return new RegExp('[&?]' + k + '=[^&]+').test(location.search);
            }

            function queryHasNoParams() {
                return !location.search;
            }
        </script>
    </body>
</html>
